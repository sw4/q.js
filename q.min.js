function format_percentage(a,d){return(100*a).toFixed(d||2)}var Array={max:function(a){return Math.max.apply(Math,a)},min:function(a){return Math.min.apply(Math,a)}};function statMean(a){var d=0,c=a.length;a.forEach(function(a){d+=parseFloat(a)});return d/c}function statStdDev(a){return Math.sqrt(statVar(a))}function statVar(a){var d=a.length,c=statMean(a),e=0;a.forEach(function(b){e+=Math.pow(b-c,2)});return 1<d?e/(d-1):e} function statHistVar(a,d){var c=a.slice(),e=c.length;c.sort();c.reverse();d=d||90;return c[Math.ceil((e-1)*(1<d?0.01*d:d))]}function statRange(a){return Array.max(a)-Array.min(a)} function statSimpleRegression(a,d){for(var c=Array.min([a.length,d.length]),e=statMean(a),b=statMean(d),k=0,l=0,g=0,f={},h=0;h<c;h++)k+=Math.pow(a[h]-e,2),l+=Math.pow(d[h]-b,2),g+=(a[h]-e)*(d[h]-b);f.slope=g/k||0;f.intercept=(100*(b-f.slope*e)).toFixed(3)||0;f.error=(100*Math.sqrt((l-f.slope*g)/(c-2))).toFixed(2);f.corrCoeff=g/Math.sqrt(k*l);f.coeffDetermination=Math.pow(f.corrCoeff,2);f.covar=(g/(c-1)*100).toFixed(3);f.tStat=(f.corrCoeff/Math.sqrt((1-f.coeffDetermination)/(c-2))).toFixed(2);f.slope= f.slope.toFixed(3);f.corrCoeff=f.corrCoeff.toFixed(3);f.coeffDetermination=f.coeffDetermination.toFixed(2);return f}function statSeries(a,d){var c={value:[],positive:[],negative:[],cumulative:[]};c.cumulative.push(d||100);a.forEach(function(a){value=parseFloat(a);c.value.push(value);0<=value?c.positive.push(value):c.negative.push(value);c.cumulative.push(c.cumulative[c.cumulative.length-1]+=c.cumulative[c.cumulative.length-1]*value)});c.cumulative.shift();return c} function dataCompile(a,d,c,e){a.slice();var b={};c=c||0.4;e=e||12;b.series=statSeries(a);b.regression=statSimpleRegression(a,d);b.count=a.length;b.stdDev=statStdDev(a);b.stdDevPositive=statStdDev(statSeries(a).positive);b.stdDevNegative=statStdDev(statSeries(a).negative);b.annStdDev=b.stdDev*Math.sqrt(e);b.annStdDevPositive=b.stdDevPositive*Math.sqrt(e);b.annStdDevNegative=b.stdDevNegative*Math.sqrt(e);b.range=statRange(a);b.histVar95=statHistVar(a,95);b.max=Array.max(a);b.min=Array.min(a);b.posCount= statSeries(a).positive.length;b.negCount=statSeries(a).negative.length;b.negMean=statMean(statSeries(a).negative);b.negPercentage=b.negCount/b.count;b.posMean=statMean(statSeries(a).positive);b.posPercentage=b.posCount/b.count;b.ttlReturn=(statSeries(a).cumulative[statSeries(a).cumulative.length-1]-100)/100;b.annCumlReturn=Math.pow(1+b.ttlReturn,1/(a.count/e))-1;b.compoundRtn=Math.pow(1+b.ttlReturn,1/a.count)-1;b.annCompoundRtn=format_percentage(b.compoundRtn*Math.sqrt(e));b.sharpe=((b.annCumlReturn- (Math.pow(1+c,12)-1))/b.annStdDev).toFixed(2);b.sortino=((b.annCumlReturn-(Math.pow(1+c,12)-1))/b.annStdDevNegative).toFixed(2);b.jensen=(parseFloat(b.annCumlReturn/100)-parseFloat(Math.pow(1+c,e)-1+b.regression.slope)*parseFloat(b.annCumlReturn-(Math.pow(1+c,e)-1))).toFixed(3);return b};